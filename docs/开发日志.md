### 最新数据库变更 (2025-09-07)

#### 1. 好友申请表 (friend_request) - 新增

```sql
CREATE TABLE `friend_request` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `requester_id` bigint unsigned NOT NULL COMMENT '申请人用户ID',
  `recipient_id` bigint unsigned NOT NULL COMMENT '接收人用户ID',
  `status` tinyint NOT NULL DEFAULT '0' COMMENT '状态：0-待处理，1-已同意，2-已拒绝，3-已忽略',
  `message` varchar(255) NOT NULL DEFAULT '' COMMENT '验证消息',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_recipient_status` (`recipient_id`, `status`) COMMENT '查询待处理申请',
  KEY `idx_requester_recipient` (`requester_id`, `recipient_id`) COMMENT '防重复申请查询',
  KEY `idx_created_at` (`created_at`) COMMENT '按时间排序'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='好友申请表';
```

#### 2. 好友关系表 (friend) - 重构

原有的 `friend` 表结构优化为独立的好友关系表，与好友申请表分离：

```sql
CREATE TABLE `friend` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `user_id` bigint unsigned NOT NULL COMMENT '用户ID',
  `friend_id` bigint unsigned NOT NULL COMMENT '好友用户ID',
  `remark` varchar(50) NOT NULL DEFAULT '' COMMENT '好友备注',
  `category_id` bigint unsigned NOT NULL DEFAULT '0' COMMENT '好友分类ID，0为默认分组',
  `is_blocked` tinyint NOT NULL DEFAULT '0' COMMENT '是否屏蔽：0-否，1-是',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_friend` (`user_id`, `friend_id`) COMMENT '防止重复好友关系',
  KEY `idx_user_id` (`user_id`) COMMENT '查询用户好友列表',
  KEY `idx_friend_id` (`friend_id`) COMMENT '反向查询',
  KEY `idx_category` (`category_id`) COMMENT '按分类查询好友'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='好友关系表';
```

#### 3. 新增 SQL 查询功能

- **friend_request.sql**: 好友申请的 CRUD 操作
- **friend.sql**: 更新后的好友关系操作，支持分类管理和屏蔽功能

#### 4. 生成的 Go 代码

- `pkg/dao/friend_request.sql.go` - 好友申请表的 SQLC 生成代码
- `pkg/dao/models.go` - 更新了 Friend 和 FriendRequest 结构体
- `pkg/mocks/mock_querier.go` - 更新了 mock 代码

#### 5. 主要改进

1. **分离关注点**: 好友申请和好友关系现在是独立的表
2. **状态管理**: 好友申请有明确的状态流转（待处理 → 已同意/已拒绝/已忽略）
3. **功能增强**: 支持好友分类、备注、屏蔽等功能
4. **索引优化**: 针对常见查询场景添加了合适的索引
5. **数据一致性**: 使用唯一键防止重复好友关系

---
