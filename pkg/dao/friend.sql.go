// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: friend.sql

package dao

import (
	"context"
	"time"
)

const blockFriend = `-- name: BlockFriend :exec
UPDATE ` + "`" + `friend` + "`" + ` 
SET is_blocked = 1, updated_at = ?
WHERE user_id = ? AND friend_id = ?
`

type BlockFriendParams struct {
	UpdatedAt time.Time `json:"updated_at"`
	UserID    uint64    `json:"user_id"`
	FriendID  uint64    `json:"friend_id"`
}

// 屏蔽好友
func (q *Queries) BlockFriend(ctx context.Context, arg BlockFriendParams) error {
	_, err := q.db.ExecContext(ctx, blockFriend, arg.UpdatedAt, arg.UserID, arg.FriendID)
	return err
}

const checkFriendship = `-- name: CheckFriendship :one
SELECT COUNT(*) as is_friend FROM ` + "`" + `friend` + "`" + ` 
WHERE user_id = ? AND friend_id = ? AND is_blocked = 0
`

type CheckFriendshipParams struct {
	UserID   uint64 `json:"user_id"`
	FriendID uint64 `json:"friend_id"`
}

// 检查两个用户是否是好友
func (q *Queries) CheckFriendship(ctx context.Context, arg CheckFriendshipParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, checkFriendship, arg.UserID, arg.FriendID)
	var is_friend int64
	err := row.Scan(&is_friend)
	return is_friend, err
}

const createFriend = `-- name: CreateFriend :exec

INSERT INTO ` + "`" + `friend` + "`" + ` (
    user_id, friend_id, remark, category_id, created_at, updated_at
) VALUES (
    ?, ?, ?, ?, ?, ?
)
`

type CreateFriendParams struct {
	UserID     uint64    `json:"user_id"`
	FriendID   uint64    `json:"friend_id"`
	Remark     string    `json:"remark"`
	CategoryID uint64    `json:"category_id"`
	CreatedAt  time.Time `json:"created_at"`
	UpdatedAt  time.Time `json:"updated_at"`
}

// Friend Relationship Queries
// 创建好友关系
func (q *Queries) CreateFriend(ctx context.Context, arg CreateFriendParams) error {
	_, err := q.db.ExecContext(ctx, createFriend,
		arg.UserID,
		arg.FriendID,
		arg.Remark,
		arg.CategoryID,
		arg.CreatedAt,
		arg.UpdatedAt,
	)
	return err
}

const createFriendRequest = `-- name: CreateFriendRequest :exec

INSERT INTO ` + "`" + `friend_request` + "`" + ` (
    requester_id, recipient_id, message, created_at, updated_at
) VALUES (
    ?, ?, ?, ?, ?
)
`

type CreateFriendRequestParams struct {
	RequesterID uint64    `json:"requester_id"`
	RecipientID uint64    `json:"recipient_id"`
	Message     string    `json:"message"`
	CreatedAt   time.Time `json:"created_at"`
	UpdatedAt   time.Time `json:"updated_at"`
}

// Friend Request Queries
// 创建好友申请
func (q *Queries) CreateFriendRequest(ctx context.Context, arg CreateFriendRequestParams) error {
	_, err := q.db.ExecContext(ctx, createFriendRequest,
		arg.RequesterID,
		arg.RecipientID,
		arg.Message,
		arg.CreatedAt,
		arg.UpdatedAt,
	)
	return err
}

const deleteFriend = `-- name: DeleteFriend :exec
DELETE FROM ` + "`" + `friend` + "`" + ` 
WHERE user_id = ? AND friend_id = ?
`

type DeleteFriendParams struct {
	UserID   uint64 `json:"user_id"`
	FriendID uint64 `json:"friend_id"`
}

// 删除好友关系
func (q *Queries) DeleteFriend(ctx context.Context, arg DeleteFriendParams) error {
	_, err := q.db.ExecContext(ctx, deleteFriend, arg.UserID, arg.FriendID)
	return err
}

const getFriend = `-- name: GetFriend :one
SELECT id, user_id, friend_id, remark, category_id, is_blocked, created_at, updated_at FROM ` + "`" + `friend` + "`" + ` 
WHERE user_id = ? AND friend_id = ? 
LIMIT 1
`

type GetFriendParams struct {
	UserID   uint64 `json:"user_id"`
	FriendID uint64 `json:"friend_id"`
}

// 获取好友关系
func (q *Queries) GetFriend(ctx context.Context, arg GetFriendParams) (Friend, error) {
	row := q.db.QueryRowContext(ctx, getFriend, arg.UserID, arg.FriendID)
	var i Friend
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.FriendID,
		&i.Remark,
		&i.CategoryID,
		&i.IsBlocked,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getFriendRequest = `-- name: GetFriendRequest :one
SELECT id, requester_id, recipient_id, status, message, created_at, updated_at FROM ` + "`" + `friend_request` + "`" + ` 
WHERE id = ?
LIMIT 1
`

// 获取好友申请
func (q *Queries) GetFriendRequest(ctx context.Context, id uint64) (FriendRequest, error) {
	row := q.db.QueryRowContext(ctx, getFriendRequest, id)
	var i FriendRequest
	err := row.Scan(
		&i.ID,
		&i.RequesterID,
		&i.RecipientID,
		&i.Status,
		&i.Message,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getFriendRequestByUsers = `-- name: GetFriendRequestByUsers :one
SELECT id, requester_id, recipient_id, status, message, created_at, updated_at FROM ` + "`" + `friend_request` + "`" + ` 
WHERE requester_id = ? AND recipient_id = ?
ORDER BY created_at DESC
LIMIT 1
`

type GetFriendRequestByUsersParams struct {
	RequesterID uint64 `json:"requester_id"`
	RecipientID uint64 `json:"recipient_id"`
}

// 根据申请人和接收人获取好友申请
func (q *Queries) GetFriendRequestByUsers(ctx context.Context, arg GetFriendRequestByUsersParams) (FriendRequest, error) {
	row := q.db.QueryRowContext(ctx, getFriendRequestByUsers, arg.RequesterID, arg.RecipientID)
	var i FriendRequest
	err := row.Scan(
		&i.ID,
		&i.RequesterID,
		&i.RecipientID,
		&i.Status,
		&i.Message,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getPendingFriendRequests = `-- name: GetPendingFriendRequests :many
SELECT id, requester_id, recipient_id, status, message, created_at, updated_at FROM ` + "`" + `friend_request` + "`" + ` 
WHERE recipient_id = ? AND status = 0
ORDER BY created_at DESC
`

// 获取待处理的好友申请列表
func (q *Queries) GetPendingFriendRequests(ctx context.Context, recipientID uint64) ([]FriendRequest, error) {
	rows, err := q.db.QueryContext(ctx, getPendingFriendRequests, recipientID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []FriendRequest{}
	for rows.Next() {
		var i FriendRequest
		if err := rows.Scan(
			&i.ID,
			&i.RequesterID,
			&i.RecipientID,
			&i.Status,
			&i.Message,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getSentFriendRequests = `-- name: GetSentFriendRequests :many
SELECT id, requester_id, recipient_id, status, message, created_at, updated_at FROM ` + "`" + `friend_request` + "`" + ` 
WHERE requester_id = ?
ORDER BY created_at DESC
`

// 获取发送的好友申请列表
func (q *Queries) GetSentFriendRequests(ctx context.Context, requesterID uint64) ([]FriendRequest, error) {
	rows, err := q.db.QueryContext(ctx, getSentFriendRequests, requesterID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []FriendRequest{}
	for rows.Next() {
		var i FriendRequest
		if err := rows.Scan(
			&i.ID,
			&i.RequesterID,
			&i.RecipientID,
			&i.Status,
			&i.Message,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUserFriends = `-- name: GetUserFriends :many
SELECT id, user_id, friend_id, remark, category_id, is_blocked, created_at, updated_at FROM ` + "`" + `friend` + "`" + ` 
WHERE user_id = ? AND is_blocked = 0
ORDER BY created_at DESC
`

// 获取用户的所有好友
func (q *Queries) GetUserFriends(ctx context.Context, userID uint64) ([]Friend, error) {
	rows, err := q.db.QueryContext(ctx, getUserFriends, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Friend{}
	for rows.Next() {
		var i Friend
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.FriendID,
			&i.Remark,
			&i.CategoryID,
			&i.IsBlocked,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUserFriendsByCategory = `-- name: GetUserFriendsByCategory :many
SELECT id, user_id, friend_id, remark, category_id, is_blocked, created_at, updated_at FROM ` + "`" + `friend` + "`" + ` 
WHERE user_id = ? AND category_id = ? AND is_blocked = 0
ORDER BY created_at DESC
`

type GetUserFriendsByCategoryParams struct {
	UserID     uint64 `json:"user_id"`
	CategoryID uint64 `json:"category_id"`
}

// 根据分类获取用户好友
func (q *Queries) GetUserFriendsByCategory(ctx context.Context, arg GetUserFriendsByCategoryParams) ([]Friend, error) {
	rows, err := q.db.QueryContext(ctx, getUserFriendsByCategory, arg.UserID, arg.CategoryID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Friend{}
	for rows.Next() {
		var i Friend
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.FriendID,
			&i.Remark,
			&i.CategoryID,
			&i.IsBlocked,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const unblockFriend = `-- name: UnblockFriend :exec
UPDATE ` + "`" + `friend` + "`" + ` 
SET is_blocked = 0, updated_at = ?
WHERE user_id = ? AND friend_id = ?
`

type UnblockFriendParams struct {
	UpdatedAt time.Time `json:"updated_at"`
	UserID    uint64    `json:"user_id"`
	FriendID  uint64    `json:"friend_id"`
}

// 取消屏蔽好友
func (q *Queries) UnblockFriend(ctx context.Context, arg UnblockFriendParams) error {
	_, err := q.db.ExecContext(ctx, unblockFriend, arg.UpdatedAt, arg.UserID, arg.FriendID)
	return err
}

const updateFriendCategory = `-- name: UpdateFriendCategory :exec
UPDATE ` + "`" + `friend` + "`" + ` 
SET category_id = ?, updated_at = ?
WHERE user_id = ? AND friend_id = ?
`

type UpdateFriendCategoryParams struct {
	CategoryID uint64    `json:"category_id"`
	UpdatedAt  time.Time `json:"updated_at"`
	UserID     uint64    `json:"user_id"`
	FriendID   uint64    `json:"friend_id"`
}

// 更新好友分类
func (q *Queries) UpdateFriendCategory(ctx context.Context, arg UpdateFriendCategoryParams) error {
	_, err := q.db.ExecContext(ctx, updateFriendCategory,
		arg.CategoryID,
		arg.UpdatedAt,
		arg.UserID,
		arg.FriendID,
	)
	return err
}

const updateFriendRemark = `-- name: UpdateFriendRemark :exec
UPDATE ` + "`" + `friend` + "`" + ` 
SET remark = ?, updated_at = ?
WHERE user_id = ? AND friend_id = ?
`

type UpdateFriendRemarkParams struct {
	Remark    string    `json:"remark"`
	UpdatedAt time.Time `json:"updated_at"`
	UserID    uint64    `json:"user_id"`
	FriendID  uint64    `json:"friend_id"`
}

// 更新好友备注
func (q *Queries) UpdateFriendRemark(ctx context.Context, arg UpdateFriendRemarkParams) error {
	_, err := q.db.ExecContext(ctx, updateFriendRemark,
		arg.Remark,
		arg.UpdatedAt,
		arg.UserID,
		arg.FriendID,
	)
	return err
}

const updateFriendRequestStatus = `-- name: UpdateFriendRequestStatus :exec
UPDATE ` + "`" + `friend_request` + "`" + ` 
SET status = ?, updated_at = ?
WHERE id = ?
`

type UpdateFriendRequestStatusParams struct {
	Status    int8      `json:"status"`
	UpdatedAt time.Time `json:"updated_at"`
	ID        uint64    `json:"id"`
}

// 更新好友申请状态
func (q *Queries) UpdateFriendRequestStatus(ctx context.Context, arg UpdateFriendRequestStatusParams) error {
	_, err := q.db.ExecContext(ctx, updateFriendRequestStatus, arg.Status, arg.UpdatedAt, arg.ID)
	return err
}
